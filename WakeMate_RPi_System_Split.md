# 🚗 WakeMate 기능 분할 설계 (Raspberry Pi 2대 구성)

## 🎯 구현 기능 개요

### ✅ 기능 ①: 졸음 감지 기반 대화형 운전자 케어
- 졸음 감지 → GPT API에 “내가 피곤하다. 말 걸어 달라” 전송
- GPT 응답 → Google TTS → 음성 출력
- 운전자의 음성 → Google STT → GPT → TTS 반복

### ✅ 기능 ②: 음성 기반 액추에이터 제어 (졸음 감지 없이)
- 운전자가 음성으로 명령 (예: "에어컨 켜줘")
- STT로 텍스트 변환 → CAN 메시지 생성 및 전송
- 수신 보드에서 CAN 수신 → GPIO 제어

---

## 🧠 시스템 분할 전략

| 역할 | Rasp1 (Vision + Command Unit) | Rasp2 (Actuator + TTS Unit) |
|------|-------------------------------|------------------------------|
| 🎥 졸음 감지 | ✅ YOLO/DMS | ❌ |
| 🎙️ 음성 입력 | ✅ STT (Google) | ✅ STT (단일 명령어 수준) |
| 💬 GPT API 요청 | ✅ (대화 흐름 제어) | ❌ |
| 🔊 TTS 및 음성 출력 | ❌ | ✅ Google TTS + 출력 |
| 🛰️ CAN 통신 | ✅ 송신 (명령 생성) | ✅ 수신 (GPIO 실행) |
| ⚙️ 액추에이터 제어 | ❌ | ✅ GPIO 제어 |
| 🔁 대화 반복 루프 | GPT ↔ STT 관리 | TTS ↔ 출력 관리 |

---

## 📦 기능 ① 흐름: 졸음 감지 대화 루프

```text
[rasp1]
카메라 → 졸음 감지
↓
GPT API 요청: "내가 피곤하다. 말 걸어 달라"
↓
응답 텍스트
↓
TTS 요청 전달 →
                   [rasp2]
                   Google TTS로 음성 생성
                   ↓
                   스피커 출력
                   ↓
                   운전자의 음성
                   ↓
                   Google STT
                   ↓
                   텍스트 → rasp1에 전달 →
                                        GPT 응답 →
                                        TTS 요청 →
                                        (반복)
```

---

## 📦 기능 ② 흐름: 음성 명령 기반 엑추에이터 제어

```text
[rasp1]
운전자: “에어컨 켜줘”
↓
Google STT
↓
텍스트 해석 → 명령 매핑
↓
CAN 메시지 전송: ID=0x300, data=0x01
↓
                   [rasp2]
                   CAN 수신
                   ↓
                   해당 GPIO 제어 (팬 ON 등)
```

---

## ✅ 결론 요약

| 보드 | 주요 구성 | 담당 기능 |
|------|------------|------------|
| **rasp1** | Camera, STT, GPT, CAN 송신 | 졸음 감지, 명령 생성, 대화 흐름 제어, CAN 제어 발신 |
| **rasp2** | MCP2515, 스피커, TTS, GPIO | CAN 수신 및 액추에이터 실행, TTS 및 음성 출력 |

---

## 💡 추가 팁
- TTS는 `rasp2`에서 수행하여 하드웨어 동작과 음성 출력을 한 번에 처리
- 필요 시 rasp1 ↔ rasp2 간 TCP 통신 보조 가능 (대화 흐름 제어 확장)
